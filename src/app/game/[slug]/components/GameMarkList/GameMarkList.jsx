'use client';
// import axiosInstance from '@/utils/scripts/api';
import { Button, Progress } from '@nextui-org/react';
// import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import React, { useEffect, useState } from 'react';

const GameMarkList = ({
  gameSlug,
  userScoreData
}) => {
  // const { data: session } = useSession();
  const router = useRouter();
  const [userMark, setUserMark] = useState('0');

  const {
    markingRaw,
    total
  } = userScoreData;

  const getClickOnMarkHandler = () => () => {};

  // const getClickOnMarkHandler = (mark) => () => {
  //   if (!session?.user) {
  //     router.replace('/authorization');
  //   }

  //   axiosInstance.patch('/games/markGame', {
  //     userEmail: session.user.email,
  //     mark,
  //     gameSlug
  //   });
  // };

  // useEffect(() => {
  //   if (session?.user) {
  //     axiosInstance.get('/comments/getCurrentUserMark' + `?gameSlug=${gameSlug}` + `&userEmail=${session.user.email}`)
  //       .then((response) => setUserMark(response.data.userMark));
  //   }
  // });

  return (
    <ul className="game__review-score-list">
      {Object.entries(markingRaw).map((item) => {
        const [ mark, currentMarkNumber ] = item;
        
        let percent = 0;

        if (currentMarkNumber > 0) {
          const percentFromTotal = currentMarkNumber / total * 100;
          percent = percentFromTotal % 1 === 0 ? percentFromTotal : percentFromTotal.toFixed(1);
        }
        
        return (
          <li key={mark} className="game__review-score-item">
            <Button
              disableRipple
              disableAnimation
              className="game__review-score-item-mark"
              onClick={getClickOnMarkHandler(mark)}
              endContent={
                userMark === mark ? (
                  <svg
                    className="game__review-score-item-mark-star"
                    xmlns="http://www.w3.org/2000/svg"
                    width="25"
                    height="25"
                    viewBox="0 0 25 25"
                    fill="none">
                    <g clipPath="url(#clip0_119_9360)">
                      <path
                        d="M1.54619 12.9479L5.10619 15.5479L3.75419 19.7349C3.5357 20.3843 3.53293 21.0869 3.7463 21.738C3.95966 22.3891 4.37773 22.9538 4.93819 23.3479C5.48904 23.7547 6.15658 23.9726 6.84134 23.9692C7.5261 23.9658 8.19143 23.7412 8.73819 23.3289L12.2192 20.7669L15.7012 23.3259C16.251 23.7304 16.915 23.9501 17.5976 23.9534C18.2801 23.9567 18.9462 23.7435 19.5 23.3444C20.0537 22.9454 20.4667 22.381 20.6795 21.7324C20.8923 21.0838 20.8939 20.3845 20.6842 19.7349L19.3322 15.5479L22.8922 12.9479C23.4413 12.5464 23.8495 11.9817 24.0585 11.3343C24.2675 10.687 24.2666 9.99011 24.0559 9.34332C23.8451 8.69652 23.4354 8.13285 22.8852 7.73283C22.335 7.33281 21.6724 7.1169 20.9922 7.11593H16.6192L15.2922 2.97993C15.0835 2.32889 14.6735 1.76094 14.1212 1.35799C13.5689 0.955045 12.9029 0.737915 12.2192 0.737915C11.5355 0.737915 10.8695 0.955045 10.3172 1.35799C9.76492 1.76094 9.35487 2.32889 9.14619 2.97993L7.81919 7.11593H3.45019C2.76993 7.1169 2.10738 7.33281 1.55717 7.73283C1.00696 8.13285 0.597228 8.69652 0.386508 9.34332C0.175789 9.99011 0.174856 10.687 0.383844 11.3343C0.592831 11.9817 1.00105 12.5464 1.55019 12.9479H1.54619Z"
                        fill="#F2F4F7"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_119_9360">
                        <rect
                          width="24"
                          height="24"
                          fill="white"
                          transform="translate(0.219238 0.547974)"
                        />
                      </clipPath>
                    </defs>
                  </svg>
                ) : (
                  <svg
                    className="game__review-score-item-mark-star"
                    xmlns="http://www.w3.org/2000/svg"
                    width="25"
                    height="25"
                    viewBox="0 0 25 25"
                    fill="none">
                    <g clipPath="url(#clip0_76_4068)">
                      <path
                        d="M24.0549 9.34229C23.8504 8.69119 23.4417 8.12321 22.8894 7.72233C22.3371 7.32145 21.6704 7.10896 20.9879 7.11629H16.6189L15.2919 2.98029C15.0833 2.32925 14.6732 1.76131 14.1209 1.35836C13.5686 0.955411 12.9026 0.738281 12.2189 0.738281C11.5353 0.738281 10.8693 0.955411 10.317 1.35836C9.76468 1.76131 9.35462 2.32925 9.14594 2.98029L7.81894 7.11629H3.44994C2.76969 7.11726 2.10713 7.33318 1.55692 7.7332C1.00671 8.13322 0.596984 8.69688 0.386264 9.34368C0.175545 9.99048 0.174612 10.6873 0.3836 11.3347C0.592587 11.982 1.0008 12.5468 1.54994 12.9483L5.10594 15.5483L3.75394 19.7353C3.53545 20.3847 3.53269 21.0873 3.74605 21.7384C3.95942 22.3895 4.37749 22.9542 4.93794 23.3483C5.48879 23.7551 6.15634 23.973 6.8411 23.9696C7.52586 23.9661 8.19119 23.7416 8.73794 23.3293L12.2189 20.7673L15.7009 23.3263C16.2508 23.7307 16.9147 23.9504 17.5973 23.9538C18.2799 23.9571 18.9459 23.7439 19.4997 23.3448C20.0535 22.9457 20.4664 22.3813 20.6792 21.7328C20.892 21.0842 20.8937 20.3849 20.6839 19.7353L19.3319 15.5483L22.8919 12.9483C23.4474 12.5518 23.8604 11.9871 24.0698 11.3376C24.2793 10.6882 24.2741 9.98855 24.0549 9.34229ZM21.7119 11.3333L17.5679 14.3623C17.3977 14.4865 17.2711 14.6612 17.2061 14.8616C17.1411 15.062 17.141 15.2779 17.2059 15.4783L18.7809 20.3483C18.8606 20.5953 18.86 20.8612 18.779 21.1078C18.698 21.3544 18.541 21.569 18.3304 21.7207C18.1198 21.8724 17.8665 21.9534 17.607 21.9521C17.3474 21.9507 17.095 21.8671 16.8859 21.7133L12.8109 18.7133C12.6393 18.5872 12.4319 18.5192 12.2189 18.5192C12.006 18.5192 11.7986 18.5872 11.6269 18.7133L7.55194 21.7133C7.34303 21.8692 7.08988 21.9545 6.82921 21.9569C6.56853 21.9593 6.31388 21.8785 6.10217 21.7264C5.89046 21.5744 5.73269 21.3588 5.65174 21.111C5.57079 20.8632 5.57086 20.596 5.65194 20.3483L7.23194 15.4783C7.29686 15.2779 7.29681 15.062 7.2318 14.8616C7.1668 14.6612 7.04015 14.4865 6.86994 14.3623L2.72594 11.3333C2.51725 11.1805 2.36218 10.9656 2.28288 10.7194C2.20359 10.4732 2.20413 10.2083 2.28443 9.96239C2.36472 9.71651 2.52067 9.5023 2.72998 9.35035C2.9393 9.19839 3.19129 9.11648 3.44994 9.11629H8.54994C8.76166 9.11629 8.96791 9.04909 9.13899 8.92437C9.31007 8.79965 9.43716 8.62386 9.50194 8.4223L11.0519 3.59129C11.1315 3.34408 11.2875 3.12849 11.4973 2.97554C11.7072 2.8226 11.9602 2.7402 12.2199 2.7402C12.4796 2.7402 12.7326 2.8226 12.9425 2.97554C13.1524 3.12849 13.3084 3.34408 13.3879 3.59129L14.9379 8.4223C15.0027 8.62386 15.1298 8.79965 15.3009 8.92437C15.472 9.04909 15.6782 9.11629 15.8899 9.11629H20.9899C21.2486 9.11648 21.5006 9.19839 21.7099 9.35035C21.9192 9.5023 22.0752 9.71651 22.1555 9.96239C22.2358 10.2083 22.2363 10.4732 22.157 10.7194C22.0777 10.9656 21.9226 11.1805 21.7139 11.3333H21.7119Z"
                        fill="#F2F4F7"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_76_4068">
                        <rect
                          width="24"
                          height="24"
                          fill="white"
                          transform="translate(0.219238 0.547974)"
                        />
                      </clipPath>
                    </defs>
                  </svg>
                )
              }>
              {mark}
            </Button>
  
            <Progress
              className="game__review-score-item-progress"
              size="sm"
              aria-label="Loading..."
              value={percent}
            />
  
            <span className="game__review-score-item-percent">
              {`${percent}%`}
            </span>
          </li>
        )
      })}
    </ul>
  );
};

export default GameMarkList;
