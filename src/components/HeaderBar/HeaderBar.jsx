'use client';
import React, { useCallback, useContext, useState } from 'react';
import logo from '../../../assets/img/logo.png';

import './styles.scss';
import {
  Button,
  Dropdown,
  DropdownItem,
  DropdownMenu,
  DropdownTrigger,
  Image,
} from '@nextui-org/react';
import { HeaderBarSearch } from './components';
import { useRouter } from 'next/navigation';
import { SidebarBurgerMenuButton } from '../Sidebar/SidebarBurgerMenuButton';
import Link from 'next/link';
import { userContextMenu } from 'appconfig';
// import { signOut, useSession } from 'next-auth/react';

export const HeaderBar = () => {
  const [isSearchActive, setIsSearchActive] = useState(false);
  const router = useRouter();

  // const { data: session } = useSession();

  const handleSearchClose = useCallback(() => setIsSearchActive(false), []);

  return (
    <div className="header-bar-wrapper">
      <div className="header-bar">
        {isSearchActive ? (
          <div className="header-bar__active-search">
            <HeaderBarSearch handleCloseInput={handleSearchClose} />
          </div>
        ) : (
          <>
            <Link href="/">
              <Image
                className="header-bar__logo"
                height={24}
                width={70}
                src={logo?.src}
                alt="logo"
              />
            </Link>

            <HeaderBarSearch
              handleCloseInput={handleSearchClose}
              isShouldBeShownFromTablet
            />

            <div className="header-bar__end">
              <Button
                className="header-bar__search-button header-bar__search-activate tertiary-button"
                onClick={() => setIsSearchActive(true)}>
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <g id="search" clipPath="url(#clip0_2277_659)">
                    <path
                      id="Vector"
                      d="M23.7068 22.2938L17.7378 16.3248C19.3644 14.3354 20.1642 11.7969 19.9716 9.23432C19.7791 6.67179 18.609 4.28129 16.7034 2.55728C14.7977 0.833269 12.3024 -0.0923492 9.73342 -0.0281174C7.16447 0.0361144 4.71849 1.08528 2.9014 2.90237C1.08431 4.71946 0.0351379 7.16545 -0.029094 9.7344C-0.0933258 12.3034 0.832293 14.7987 2.5563 16.7043C4.28031 18.61 6.67081 19.7801 9.23334 19.9726C11.7959 20.1651 14.3344 19.3654 16.3238 17.7388L22.2928 23.7078C22.4814 23.8899 22.734 23.9907 22.9962 23.9884C23.2584 23.9862 23.5092 23.881 23.6946 23.6956C23.88 23.5102 23.9852 23.2594 23.9875 22.9972C23.9897 22.735 23.8889 22.4824 23.7068 22.2938ZM9.99978 18.0008C8.41753 18.0008 6.87081 17.5316 5.55522 16.6525C4.23963 15.7735 3.21425 14.524 2.60875 13.0622C2.00324 11.6004 1.84482 9.99189 2.1535 8.44004C2.46218 6.88819 3.22411 5.46272 4.34293 4.3439C5.46175 3.22508 6.88721 2.46316 8.43906 2.15448C9.99091 1.84579 11.5994 2.00422 13.0613 2.60972C14.5231 3.21522 15.7725 4.2406 16.6515 5.5562C17.5306 6.87179 17.9998 8.41851 17.9998 10.0008C17.9974 12.1218 17.1538 14.1552 15.654 15.655C14.1542 17.1548 12.1208 17.9984 9.99978 18.0008Z"
                      fill="#475467"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_2277_659">
                      <rect width="24" height="24" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </Button>

              {false ? (
                <>
                  <SidebarBurgerMenuButton shouldDissapearFrom={'tablet'} />

                  {/* <Button className="header-bar__search-button header-bar__search-notifications secondary-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g clipPath="url(#clip0_2299_10198)">
                        <path d="M22.5555 13.6619L20.6555 6.82593C20.0986 4.82327 18.8882 3.06422 17.2168 1.8284C15.5454 0.592587 13.5089 -0.049079 11.4309 0.00540109C9.35299 0.0598812 7.35288 0.807381 5.74853 2.12908C4.14419 3.45078 3.02767 5.27084 2.57647 7.29993L1.10547 13.9149C0.942986 14.6459 0.946742 15.404 1.11646 16.1333C1.28618 16.8625 1.61753 17.5444 2.08605 18.1285C2.55457 18.7126 3.14829 19.184 3.82338 19.5079C4.49847 19.8318 5.23769 20 5.98647 19.9999H7.10047C7.32999 21.1302 7.9432 22.1464 8.83621 22.8763C9.72922 23.6062 10.8471 24.0049 12.0005 24.0049C13.1538 24.0049 14.2717 23.6062 15.1647 22.8763C16.0577 22.1464 16.671 21.1302 16.9005 19.9999H17.7385C18.5093 20 19.2697 19.8218 19.9602 19.4794C20.6508 19.1369 21.2528 18.6394 21.7193 18.0258C22.1858 17.4122 22.504 16.699 22.6493 15.942C22.7945 15.185 22.7627 14.4046 22.5565 13.6619H22.5555ZM12.0005 21.9999C11.3822 21.9974 10.7798 21.8039 10.2758 21.4458C9.7717 21.0878 9.39055 20.5828 9.18447 19.9999H14.8165C14.6104 20.5828 14.2292 21.0878 13.7252 21.4458C13.2211 21.8039 12.6187 21.9974 12.0005 21.9999ZM20.1265 16.8149C19.8478 17.1846 19.4868 17.4842 19.0721 17.6899C18.6574 17.8956 18.2004 18.0018 17.7375 17.9999H5.98647C5.53725 17.9999 5.09379 17.8989 4.68881 17.7045C4.28383 17.5101 3.92768 17.2273 3.64663 16.8768C3.36559 16.5264 3.16683 16.1173 3.06503 15.6798C2.96323 15.2423 2.96099 14.7874 3.05847 14.3489L4.52847 7.73293C4.88282 6.13914 5.75978 4.70954 7.01993 3.67138C8.28008 2.63323 9.85109 2.04611 11.4832 2.00335C13.1154 1.96059 14.715 2.46465 16.0278 3.4354C17.3406 4.40616 18.2912 5.78788 18.7285 7.36093L20.6285 14.1969C20.754 14.6423 20.774 15.1108 20.6869 15.5653C20.5997 16.0197 20.4079 16.4476 20.1265 16.8149Z" fill="white"/>
                      </g>
                      <defs>
                        <clipPath id="clip0_2299_10198">
                          <rect width="24" height="24" fill="white"/>
                        </clipPath>
                      </defs>
                    </svg>
                  </Button>

                  <Button className="header-bar__search-button header-bar__search-favorites secondary-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g clipPath="url(#clip0_2299_10203)">
                        <path d="M17.5009 1.9165C16.3749 1.93402 15.2734 2.24836 14.3077 2.82778C13.342 3.40719 12.5463 4.23117 12.0009 5.2165C11.4556 4.23117 10.6599 3.40719 9.69417 2.82778C8.72848 2.24836 7.62698 1.93402 6.50094 1.9165C4.70588 1.99449 3.01464 2.77976 1.79672 4.10074C0.578794 5.42171 -0.0668157 7.17103 0.000934853 8.9665C0.000934853 13.5135 4.78693 18.4795 8.80093 21.8465C9.69715 22.5996 10.8303 23.0125 12.0009 23.0125C13.1716 23.0125 14.3047 22.5996 15.2009 21.8465C19.2149 18.4795 24.0009 13.5135 24.0009 8.9665C24.0687 7.17103 23.4231 5.42171 22.2052 4.10074C20.9872 2.77976 19.296 1.99449 17.5009 1.9165ZM13.9159 20.3165C13.3799 20.7679 12.7017 21.0154 12.0009 21.0154C11.3002 21.0154 10.622 20.7679 10.0859 20.3165C4.94793 16.0055 2.00093 11.8695 2.00093 8.9665C1.93258 7.70122 2.3673 6.46023 3.2103 5.5142C4.0533 4.56817 5.23617 3.99385 6.50094 3.9165C7.7657 3.99385 8.94857 4.56817 9.79157 5.5142C10.6346 6.46023 11.0693 7.70122 11.0009 8.9665C11.0009 9.23172 11.1063 9.48607 11.2938 9.67361C11.4814 9.86115 11.7357 9.9665 12.0009 9.9665C12.2662 9.9665 12.5205 9.86115 12.708 9.67361C12.8956 9.48607 13.0009 9.23172 13.0009 8.9665C12.9326 7.70122 13.3673 6.46023 14.2103 5.5142C15.0533 4.56817 16.2362 3.99385 17.5009 3.9165C18.7657 3.99385 19.9486 4.56817 20.7916 5.5142C21.6346 6.46023 22.0693 7.70122 22.0009 8.9665C22.0009 11.8695 19.0539 16.0055 13.9159 20.3125V20.3165Z" fill="white"/>
                      </g>
                      <defs>
                        <clipPath id="clip0_2299_10203">
                          <rect width="24" height="24" fill="white"/>
                        </clipPath>
                      </defs>
                    </svg>
                  </Button> */}

                  <Dropdown>
                    <DropdownTrigger>
                      <Button className="header-bar__search-button header-bar__search-user secondary-button">
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg">
                          <g clipPath="url(#clip0_2299_10208)">
                            <path
                              d="M12 12C13.1867 12 14.3467 11.6481 15.3334 10.9888C16.3201 10.3295 17.0892 9.39246 17.5433 8.2961C17.9974 7.19975 18.1162 5.99335 17.8847 4.82946C17.6532 3.66558 17.0818 2.59648 16.2426 1.75736C15.4035 0.918247 14.3344 0.346802 13.1705 0.115291C12.0067 -0.11622 10.8003 0.00259972 9.7039 0.456726C8.60754 0.910851 7.67047 1.67989 7.01118 2.66658C6.35189 3.65328 6 4.81331 6 6C6.00159 7.59081 6.63424 9.11602 7.75911 10.2409C8.88399 11.3658 10.4092 11.9984 12 12ZM12 2C12.7911 2 13.5645 2.2346 14.2223 2.67412C14.8801 3.11365 15.3928 3.73836 15.6955 4.46927C15.9983 5.20017 16.0775 6.00444 15.9231 6.78036C15.7688 7.55629 15.3878 8.26902 14.8284 8.82843C14.269 9.38784 13.5563 9.7688 12.7804 9.92314C12.0044 10.0775 11.2002 9.99827 10.4693 9.69552C9.73836 9.39277 9.11365 8.88008 8.67412 8.22228C8.2346 7.56449 8 6.79113 8 6C8 4.93914 8.42143 3.92172 9.17157 3.17158C9.92172 2.42143 10.9391 2 12 2Z"
                              fill="white"
                            />
                            <path
                              d="M12 14.0005C9.61386 14.0031 7.32622 14.9522 5.63896 16.6395C3.95171 18.3267 3.00265 20.6144 3 23.0005C3 23.2657 3.10536 23.5201 3.29289 23.7076C3.48043 23.8951 3.73478 24.0005 4 24.0005C4.26522 24.0005 4.51957 23.8951 4.70711 23.7076C4.89464 23.5201 5 23.2657 5 23.0005C5 21.144 5.7375 19.3635 7.05025 18.0507C8.36301 16.738 10.1435 16.0005 12 16.0005C13.8565 16.0005 15.637 16.738 16.9497 18.0507C18.2625 19.3635 19 21.144 19 23.0005C19 23.2657 19.1054 23.5201 19.2929 23.7076C19.4804 23.8951 19.7348 24.0005 20 24.0005C20.2652 24.0005 20.5196 23.8951 20.7071 23.7076C20.8946 23.5201 21 23.2657 21 23.0005C20.9974 20.6144 20.0483 18.3267 18.361 16.6395C16.6738 14.9522 14.3861 14.0031 12 14.0005Z"
                              fill="white"
                            />
                          </g>
                          <defs>
                            <clipPath id="clip0_2299_10208">
                              <rect width="24" height="24" fill="white" />
                            </clipPath>
                          </defs>
                        </svg>
                      </Button>
                    </DropdownTrigger>

                    <DropdownMenu>
                      {userContextMenu.map(({ id, title, getLink }) => (
                        <DropdownItem key={id}>
                          {/* TODO: Unhardcode username */}
                          <Link href={getLink('test')}>
                            {title}
                          </Link>
                        </DropdownItem>
                      ))}

                      <DropdownItem>
                        <Button className="header-bar__search-button--signout" onClick={() => signOut()}>
                          {'Sign out'}
                        </Button>
                      </DropdownItem>
                    </DropdownMenu>
                  </Dropdown>
                </>
              ) : (
                <>
                  <Button
                    className="header-bar__search-button primary-button"
                    onClick={() => router.push('/registration')}>
                    Sign up
                  </Button>

                  <Button
                    className="header-bar__search-button header-bar__search-sign-in secondary-button"
                    onClick={() => router.push('/authorization')}>
                    Sign in
                  </Button>
                </>
              )}
            </div>
          </>
        )}
      </div>
    </div>
  );
};
